webpackJsonp([7,147],{67:function(e,t){"use strict";var n=null,o={};o.get=function(){return n},o.set=function(e){n=e},e.exports=o},111:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(18,function(t){e(n(273))})})}},127:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var s=n(16),i=o(s),a=n(11),r=o(a),u=n(132),c=o(u),d=n(111),v=o(d),l=n(9),h=o(l),f=n(44),p=o(f),_=n(29),C=o(_),g=n(1726),m=o(g),y=n(1725),I=o(y),A=n(1722),E=o(A),T=n(45),R=o(T),w=n(67),b=o(w),N=n(8),M=o(N),k=n(163),P=o(k),O=n(4),L=o(O),U=n(1724),S=o(U),x=n(19),B=o(x),D=n(18),j=o(D),H=5,q=72,F=function V(){this.activeConversationsContainer=null,this.conversations={},this.conversationIdToLastMessageId={},this.conversationIds=[],this._openConversation=null,this._logger=R["default"].getLogger("ConversationsManager"),this.conversationsUpdater=new E["default"](this)};Object.assign(F.prototype,c["default"]),Object.assign(F.prototype,{_fetchingConversations:!1,_loadedInitialConversations:!1,_pendingRequest:null,getContainer:function G(){return this.activeConversationsContainer},setContainer:function W(e){this.activeConversationsContainer=e},listenForConversations:function J(){var e=this;j["default"].isAuthenticated()&&!j["default"].isLimitedLogin()&&(0,S["default"])().then(function(t){e.listenTo(t.instance(),"conversations_unseen_count",e.onUnseenConversationsCount)})},onUnseenConversationsCount:function K(e){var t=this;e>0||this._shouldUpdateConversations?this._fetchConversations().then(function(n){t._shouldUpdateConversations=!1,t._updateActiveConversations(n),M["default"].instance.publish("site","conversationUnreadCount",e)}):M["default"].instance.publish("site","conversationUnreadCount",e)},_fetchConversations:function Y(){var e=this;return this._fetchingConversations||!function(){var t=L["default"].create("ConversationsResource",{});e._pendingRequest=P["default"].instance.callGet(t),e._pendingRequest.then(function(){e._conversationsBookmarks=t.get("bookmarks")}).fin(function(){e._fetchingConversations=!1}),e._fetchingConversations=!0}(),this._pendingRequest},getConversationsBookmarks:function $(){return this._conversationsBookmarks},_updateActiveConversations:function Q(e){var t=this;r["default"].each(e,function(e){var n=e.id,o=e.last_message,s=t.conversationIdToLastMessageId[n];o&&o.id!==s&&(r["default"].isUndefined(s)&&e.unread<=0||(r["default"].contains(t.conversationIds,n)?t.conversations[n].updateConversation(e):o.sender.id!==j["default"].get("id")&&t.addConversation(e,!1),t.conversationIdToLastMessageId[n]=o.id))})},deleteConversationBadgeCount:function z(){var e=L["default"].create("ConversationBadgeResource",{});e.callDelete({showError:!1})},sendMessageToUsers:function X(e,t,n){var o=this,s={user_ids:e||[],emails:t||[]},i=this._sendNewMessage("ConversationsResource",s,n);return i.then(function(e){var t=e.resource_response.data;o.addConversation(t)}),i},sendMessageToConversation:function Z(e,t){var n={conversation_id:e};return this._sendNewMessage("ConversationMessagesResource",n,t)},_sendNewMessage:function ee(e,t,n){var o=this;n.text&&(t.text=n.text),n.object_id&&(t[n.object_type]=n.object_id);var s=L["default"].create(e,t),i=s.callCreate({error:this._handleSendMessageError.bind(this)});return i.then(function(){o._shouldUpdateConversations=!0}),i},_handleSendMessageError:function te(e){var t=e.extra_data;243===e.api_error_code&&t.objects&&!function(){var e=t.objects;(0,v["default"])().then(function(t){var n=new t({options:{template:"message_object_auth_error",attached_object:e.object,users:e.users,emails:e.emails}});b["default"].get().createAndShowModal(n)})}()},logContextEvent:function ne(e,t,n,o){var s=p["default"].fromEventType(e);if(n&&s.setObjectIdStr(n),o){if(o.attr("data-element-type")){var i=parseInt(o.attr("data-element-type"),10);s.setElement(i)}var a=o.closest("[data-component-type]");if(a.length){var r=parseInt(a.attr("data-component-type"),10);s.setComponent(r)}}s.updateAuxData({conversation_id:t}),C["default"].getInstance().addEvent(s)},_addConversationToDom:function oe(e,t,n){var o=this,s=this.getContainer();if(!s)return Promise.resolve(void 0);var i=e.id;this.conversationIds.push(i);var a={id:i};return j["default"].isAuthenticated()&&!j["default"].isLimitedLogin()||(a.unauth=!0),e.users=r["default"].reject(e.users,function(e){return e.id===j["default"].get("id")}),t&&(a.peek=!1),(0,I["default"])().then(function(r){var u=new r({options:a,data:e}),c=u.renderExistingData().then(function(){o.conversations[i]=u,o.resetConversationHeadTransforms(),s.appendChild(u),n&&u.setInactive(),u.setBadgeCount(e.unread),t?o.openConversation(u):o._openConversation&&o._openConversation.adjustPopup(),u.focus(),o._ensureWithinMaxNumberOfConversations()});return c})},_animateAddConversation:function se(e,t){var n=this,o=r["default"].reject(e.users,function(e){return e.id===j["default"].get("id")}),s=function(){this._addConversationToDom(e,t)}.bind(this);t&&this._openConversation&&this._openConversation.closePopup(),(0,m["default"])().then(function(t){var i=e&&e.board,a=new t({options:{users:o,emails:e.emails,group_board_name:i&&i.name,group_board_rep_url:i&&i.image_thumbnail_url}});a.render().then(function(){var e=n._makeAnimatedElement(a.$el);n._animateShowConversationHead(e,s)})})},_makeAnimatedElement:function ie(e){var t=e.clone();return t.addClass("cloned").offset({left:-1e3,top:-1e3}).appendTo((0,i["default"])("body")),t},_animateShowConversationHead:function ae(e,t){var n=this.getContainer(),o=n.getContent(),s=o.offset(),a=s.left,r=s.top,u=n.getHeight(!0),c=o.find(".ConversationHead");c.transition({y:-q},280,"ease"),e.addClass("normal opening"),e.removeClass("medium small"),e.width(h["default"].ACTIVE_CONVERSATION_HEAD_DIMENSION).height(h["default"].ACTIVE_CONVERSATION_HEAD_DIMENSION).css("visibility","hidden"),e.offset({left:a,top:r+u-h["default"].ACTIVE_CONVERSATION_HEAD_DIMENSION-3}),e.transition({scale:0,duration:1},function(){(0,i["default"])(this).css("visibility","")}).transition({scale:1.2,duration:180}).transition({scale:1,duration:100},function(){t(),e.remove()})},_ensureWithinMaxNumberOfConversations:function re(){if(this.conversationIds.length>H){var e=this.conversationIds[0];this.removeOverboundsConversation(e)}},removeOverboundsConversation:function ue(e){var t=this,n=this.conversations[e],o=n.getContent();o.transition({scale:.8},200).transition({scale:2,opacity:0},200,"ease",function(){t.resetConversationHeadTransforms(),t.removeConversationById(e)})},loadInitialConversations:function ce(e){var t=this;this._publishNoActiveConversationsIfNeeded(),this._fetchConversations().then(function(n){var o=!!e,s=r["default"].map(n,function(n){var s=n.id===e;return s?(o=!1,t._addConversationToDom(n,!0)):void 0});Promise.all(s).then(function(){t._updateActiveConversations(n),o&&t.addConversationById(e,!0),M["default"].instance.publish("currentMessages","conversationsLoaded"),t._loadedInitialConversations=!0})})},hasLoadedInitialConversations:function de(){return this._loadedInitialConversations},addConversation:function ve(e,t){r["default"].isUndefined(t)&&(t=!0),M["default"].instance.publish("messages","conversationAdded");var n=e.id,o=this.conversations[n];o?(o.updateConversation(e),t&&this.openConversation(o)):this._animateAddConversation(e,t)},addConversationById:function le(e,t){var n=this;if(r["default"].contains(this.conversationIds,e))return void(t&&this.openConversation(this.conversations[e]));var o=L["default"].create("ConversationResource",{conversation_id:e});o.callGet({showError:!1}).then(function(e){var o=e.resource_response.data;n.addConversation(o,t)})},addConversationForUnauthUser:function he(e){var t=this,n=B["default"].getQueryStringParams(),o=n.user_id,s=n.od;if(o&&s){var i=L["default"].create("UnauthConversationResource",{conversation_id:e,user_id:o,od:s});i.callGet().then(function(e){var n=e.resource_response.data;t._unauthUserEmail=n.unauth_user_email;var o=n.conversation;t.addConversation(o,!0)})}},getUnauthUserEmail:function fe(){return this._unauthUserEmail},listenForActiveConversationUpdates:function pe(){j["default"].isAuthenticated()&&!j["default"].isLimitedLogin()&&((0,S["default"])().then(function(e){e.instance().setMinPoll(h["default"].UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL)}),this.conversationsUpdater.activate(),this.activeConversationsListener||(this.activeConversationsListener=this.listenTo(this.conversationsUpdater,"active_conversations",this.onActiveConversationsUpdate)))},getOpenConversationId:function _e(){return this._openConversation?this._openConversation.data.id:!1},onActiveConversationsUpdate:function Ce(e){this._updateActiveConversations(e)},stopListeningForActiveConversationUpdates:function ge(){j["default"].isAuthenticated()&&!j["default"].isLimitedLogin()&&(this.conversationsUpdater.deactivate(),(0,S["default"])().then(function(e){e.instance().setMinPoll(h["default"].UPDATES_MIN_POLL)}),this.activeConversationsListener&&(this.stopListening(this.activeConversationsListener),this.activeConversationsListener=null))},getConversationIds:function me(){return this.conversationIds},hasActiveConversations:function ye(){return this.getConversationIds().length>0},resetConversationHeadTransforms:function Ie(){var e=this.getContainer();e&&e.$(".ConversationHead").css("transform","")},scaleConversationDownAndRemove:function Ae(e){var t=this,n=this.conversations[e],o=n.getContent(),s=r["default"].indexOf(this.conversationIds,e),i=this.getContainer().getConversationHeads(),a=i.slice(0,s);o.transition({scale:1.1},120,function(){a.length&&a.transition({y:q},140)}).transition({scale:0},140,"ease",function(){t.resetConversationHeadTransforms(),t.removeConversationById(e)})},removeConversationById:function Ee(e){if(this.conversationIds=r["default"].without(this.conversationIds,e),this.conversations[e]){this._openConversation&&(this._openConversation.getConversationId()===e?this.closeConversation(this._openConversation):this._openConversation.adjustPopup());var t=this.conversations[e];t.destroy(),delete this.conversations[e],this._publishNoActiveConversationsIfNeeded()}},_publishNoActiveConversationsIfNeeded:function Te(){0===this.conversationIds.length&&M["default"].instance.publish("messages","conversationNoActiveConversations")},closeAllConversations:function Re(){var e=this;r["default"].each(this.conversations,function(t){e.closeConversation(t)})},closeConversation:function we(e){this.stopListeningForActiveConversationUpdates(),this.setAllActive(),e.closePopup(),this._openConversation===e&&(this._openConversation=null,M["default"].instance.publish("messages","conversationClosed",null))},setAllActive:function be(){r["default"].each(this.conversations,function(e){e.setActive()})},setAllInactive:function Ne(e){var t=this;r["default"].each(this.conversations,function(e){e!==t._openConversation&&e.setInactive()})},closeConversationById:function Me(e){var t=this.conversations[e];t&&this.closeConversation(t)},openConversation:function ke(e){this.conversations[e.getConversationId()]&&(this._openConversation?(this._openConversation.setInactive(),this._openConversation.closePopup()):this.setAllInactive(e),this._openConversation=e,this._openConversation.setActive(),e.showPopup(),M["default"].instance.publish("messages","conversationOpen",null),this.listenForActiveConversationUpdates())}}),e.exports=new F},163:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var s=n(11),i=o(s),a=n(3115),r=o(a),u=n(3214),c=o(u),d=n(51),v=o(d),l={};l.Freshness={POSSIBLY_STALE_AND_INCOMPLETE:1,FRESH:2};var h=["NetworkStoriesResource","NotificationsResource","ConversationsResource","BoardInvitesResource"],f=function y(e){return i["default"].isObject(e)?i["default"].sortBy(i["default"].map(i["default"].pairs(e),function(e){return[e[0],y(e[1])]}),function(e){return e[0]}):e},p=function I(e){return JSON.stringify(f(e))},_=function A(){};_.prototype.ensureModel=function(e,t){},_.prototype.invalidate=function(e){};var C=function E(e,t){this._entityType=e,this._modelManager=t};C.prototype.ensureModel=function(e,t){var n=e.options.id;return this._modelManager.ensureModel(this._entityType,n,t)},C.prototype.invalidate=function(e){};var g=function T(){this._cache={},this._bookmarkResponses={}};g.prototype._getKey=function(e){var t=i["default"].omit(e.options,"bookmarks");return t.bookmark=e.getLatestBookmark(),p(t)},g.prototype.ensureModel=function(e,t){var n=this._getKey(e),o=this._cache[n];return-1!==i["default"].indexOf(h,e.name)&&e.options.bookmarks&&(o=null),o?o.updateData(t):o=this._cache[n]=new r["default"](t),o},g.prototype.invalidate=function(e){this._cache={}},g.prototype.getBookmarkResponse=function(e){return this._bookmarkResponses[e]},g.prototype.setBookmarkResponse=function(e,t){this._bookmarkResponses[e]=t};var m=function R(e){this._resourceCacheStrategies=e};m.prototype.callGet=function(e,t,n){var o=t&&t.module,s=this._resourceCacheStrategies[e.name],a=e.getLatestBookmark(),r=-1!==i["default"].indexOf(h,e.name),u=e.callGet({showError:!1},void 0,t&&t.headers).then(function(e){return r&&(s.setBookmarkResponse(a,e.bookmarks),o&&o.resource.setBookmarks(e.bookmarks)),e.resource_response.data});if(s){var c=s.ensureModel(e,u);return n&&n.freshness===l.Freshness.POSSIBLY_STALE_AND_INCOMPLETE?(r&&o.resource.setBookmarks(s.getBookmarkResponse(a)),c.getNonEmptyData()):u}return u},m.prototype.callCreate=function(e){var t=e.callCreate();return t.then(function(){"PinCommentResource"===e.name&&c["default"].instance.invalidate(c["default"].EntityType.PIN,e.options.pin_id)}),t},m.prototype.ensureModel=function(e,t){var n=this._resourceCacheStrategies[e.name];return n?n.ensureModel(e,Promise.resolve(t)):null},m.prototype.invalidate=function(e){var t=this._resourceCacheStrategies[e.name];t&&t.invalidate(e)},l.instance=l.instance||new m({PinResource:new C(c["default"].EntityType.PIN,c["default"].instance),BoardsResource:new g,BoardPickerBoardsResource:new g,ConversationsResource:new g,NotificationsResource:new g,NetworkStoriesResource:new g,UserExperienceWithContextResource:new g,BoardInvitesResource:new g}),e.exports=v["default"].expose("resourceCache",l)},1722:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var s=n(132),i=o(s),a=n(9),r=o(a),u=n(4),c=o(u),d=function v(e){this.conversationsManager=e,this.conversationsUpdatesResource=c["default"].create("ConversationsUpdatesResource",{}),this.poller=null,this._numRetries=0,this._requestConversationId=null,this._pollInterval=null};Object.assign(d.prototype,i["default"]),Object.assign(d.prototype,{fetch:function l(){var e=this;if(!this.pendingRequest){var t=this.conversationsManager.getOpenConversationId();t&&(this.pendingRequest=!0,this._requestConversationId!==t&&(this._requestConversationId=t,this.conversationsUpdatesResource.resetBookmark(),this.conversationsUpdatesResource.setOptions({conversation_ids:[this._requestConversationId]})),this.conversationsUpdatesResource.callGet({showError:!1}).then(function(t){e.pendingRequest=!1,e._numRetries=0;var n=t.resource_response.data,o=n.updated_conversations||[];e._activated&&n.wait&&e._setNextPoll(1e3*n.wait),o.length>0&&e.trigger("active_conversations",o)},function(){e.pendingRequest=!1,e.deactivateIfNecessary()}))}},deactivateIfNecessary:function h(){this._numRetries+=1,this._numRetries>5&&this.deactivate()},deactivate:function f(){this._resetPoller(),this.pendingRequest=!1,this._activated=!1},activate:function p(){this._setNextPoll(r["default"].OPEN_CONVERSATION_MIN_POLL),this._numRetries=0,this._activated=!0},_setNextPoll:function _(e){var t=this;this.pendingRequest||(e&&this._pollInterval===e||this._resetPoller(),e&&this._pollInterval!==e&&(this.poller=window.setInterval(function(){t.fetch()},e)),this._pollInterval=e)},_resetPoller:function C(){this.poller&&clearInterval(this.poller),this.poller=null,this._pollInterval=null},isActive:function g(){return this._activated}}),e.exports=d},1724:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(131,function(t){e(n(1296))})})}},1725:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(79,function(t){e(n(1297))})})}},1726:function(e,t,n){e.exports=function(){return new Promise(function(e){n.e(80,function(t){e(n(298))})})}},3115:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(930),a=o(i),r=function(){function e(t){var n=this;s(this,e),this._data=null,this._onChangeHandler=function(){},this._modelAvailablePromise=t.then(function(e){n.set(e)})}return e.prototype.set=function t(e){var t=e instanceof Array;if(this._data){var n=void 0;t?n=e:(n=this._data,a["default"].deepExtend(!0,n,e)),this._data=n,this._onChangeHandler(this)}else this._data=e,this._onChangeHandler(this)},e.prototype.updateData=function n(e){var t=this;e.then(function(e){t.set(e)})},e.prototype.getNonEmptyData=function o(){var e=this;return this._modelAvailablePromise.then(function(t){return e.getData()})},e.prototype.getData=function i(){return this._data},e.prototype.onChange=function r(e){var t=this;this._modelAvailablePromise.then(function(){t._onChangeHandler=e})},e}();e.exports=r},3214:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var s=n(11),i=o(s),a=n(889),r=o(a),u=n(3115),c=o(u),d={};d.EntityType={PIN:"pin"},d.EntityDict,d.EntityId;var v=1e3,l=function f(e){this.cache=new r["default"](v),this._entityType=e};l.prototype.getModel=function(e){return this.cache.get(e)},l.prototype.addEntityDict=function(e){if(e.type!==this._entityType)throw new Error("invalid entityDict type");var t=e.id;this.ensureModel(t,Promise.resolve(e))},l.prototype.ensureModel=function(e,t){var n=this.cache.get(e);return n||(n=new c["default"](t),this.cache.set(e,n)),n.updateData(t),n},l.prototype.remove=function(e){this.cache.remove(e)};var h=function p(){var e=this;this.entityTypeToCache={},i["default"].each(d.EntityType,function(t){e.entityTypeToCache[t]=new l(t)})};h.prototype.getModel=function(e,t){var n=this.entityTypeToCache[e];return n?n.getModel(t):null},h.prototype.add=function(e){var t=this;if(e instanceof Array)e.forEach(function(e){t._addEntity(e)});else if(e instanceof Object){var n=e;this._addEntity(n)}},h.prototype.ensureModel=function(e,t,n){var o=this.entityTypeToCache[e];if(!o)throw new Error("unexpected entityType "+e);return o.ensureModel(t,n)},h.prototype.invalidate=function(e,t){var n=this.entityTypeToCache[e];if(!n)throw new Error("unexpected entityType "+e);n.remove(t)},h.prototype._addEntity=function(e){var t=e.type;if(t){var n=t,o=this.entityTypeToCache[n];if(o){var s=e.id;"string"==typeof s&&o.ensureModel(s,Promise.resolve(e))}}},d.instance=new h,e.exports=d}});